# 崩溃修复说明

## 修复的问题

### 1. initWidget 函数未定义
**问题**: `autoload.js` 在 `waifu-tips.js` 完全加载和执行之前就尝试调用 `initWidget()`

**修复**: 
- 添加了等待机制，检查 `window.initWidget` 是否可用
- 最多等待 5 秒（50 次重试，每次 100ms）
- 如果超时，显示明确的错误信息

### 2. ES6 模块加载问题
**问题**: `waifu-tips.js` 使用 ES6 `export` 语法，但加载时没有设置 `type="module"`

**修复**: 
- 检测到 `waifu-tips.js` 时，自动设置 `type="module"`
- 确保模块可以正确加载和导出

### 3. 错误处理增强
**问题**: 错误信息不够详细，难以调试

**修复**:
- 添加了完整的错误堆栈输出
- 改进了用户可见的错误提示
- 添加了全局错误捕获

## 测试建议

1. 打开 Chrome 开发者工具（F12）
2. 查看 Console 标签页
3. 检查是否有错误信息
4. 如果看到错误，请查看完整的错误堆栈

## 如果仍然崩溃

请检查：
1. Chrome 控制台中的具体错误信息
2. 网络请求是否成功（Network 标签页）
3. `waifu-tips.js` 是否正确加载
4. `model_list.json` 是否存在且格式正确

